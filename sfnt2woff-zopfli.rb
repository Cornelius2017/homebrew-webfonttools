require "formula"
require "base64"

class Sfnt2woffZopfli < Formula
  homepage "https://github.com/bramstein/sfnt2woff-zopfli"
  url "https://github.com/bramstein/sfnt2woff-zopfli/archive/v1.0.1.tar.gz"
  sha1 "c9d182508c59cf1d17df16abedb534542196bcc7"

  def install
    system "make"
    bin.install "sfnt2woff-zopfli"
    bin.install "woff2sfnt-zopfli"
  end

  test do
    woff64_input = "d09GRgABAAAAAAHcAAoAAAAAAggAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABTAAAABcAAABOBIQEIWNtYXAAAAFsAAAAJgAAACwADABzZ2x5ZgAAAZwAAAAUAAAAFAgBOQJoZWFkAAAA9AAAACwAAAA2A+TgRGhoZWEAAAEgAAAAFQAAACQIAQQDaG10eAAAAWQAAAAIAAAACAQAAABsb2NhAAABlAAAAAYAAAAGAAoAAG1heHAAAAE4AAAAEwAAACAABAACbmFtZQAAAbAAAAAeAAAAIAAjCF5wb3N0AAAB0AAAAAwAAAAgAAMAAHgBY2BkYADhHCfPyfH8Nl8ZmFgYQOBCWvVrMJ0pnwKiWYAQDJhABAD1VweUeAFjYGRgYGEAAjgJFEEFTAABkgARAAAAeAFjYGRgYGACQiCNDQAAAL4ABwB4AWMAgRQGRgZygQKDAguYASIBIFEArgAAAAAABAAAAHgBY2BgYGRgBmIGBh4GFgYFIM0ChCC+w///EPL/QTCfAQBNfgZ8AAAAAAAAAAoAAAABAAAAAAQABAAAAQAAMQEEAAQAeAFjYGBgYpBjYGZgZOFkYASyGaBsJjDbAQAGMwCKAAB4AWNgZsALAAB9AAQ="
    ttf64_input = "AAEAAAAKAIAAAwAgT1MvMgSEBCEAAAEoAAAATmNtYXAADABzAAABgAAAACxnbHlmCAE5AgAAAbQAAAAUaGVhZAPk4EQAAACsAAAANmhoZWEIAQQDAAAA5AAAACRobXR4BAAAAAAAAXgAAAAIbG9jYQAKAAAAAAGsAAAABm1heHAABAACAAABCAAAACBuYW1lACMIXgAAAcgAAAAgcG9zdAADAAAAAAHoAAAAIAABAAAAAQAAbEJJk18PPPUAAgQAAAAAANBme+sAAAAA0GkfZAAAAAAEAAQAAAAAAAACAAAAAAAAAAEAAAQAAAAAAAQAAAAAAAQAAAEAAAAAAAAAAAAAAAAAAAACAAEAAAACAAIAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAIAQAAAAAAAQAAAAAAAAAAAAEAAAAAAAAAQADAAEAAAAMAAQAIAAAAAQABAABAAAAQP//AAAAQP///8EAAQAAAAAAAAAAAAoAAAABAAAAAAQABAAAAQAAMQEEAAQAAAAAAgAeAAMAAQQJAAEAAgAAAAMAAQQJAAIAAgAAAEAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="

    (testpath/"encode.ttf").write Base64.decode64(ttf64_input)
    system bin/"sfnt2woff-zopfli", (testpath/"encode.ttf")
    woff64_output = Base64.strict_encode64(File.read(testpath/"encode.woff"))
    assert_equal woff64_input, woff64_output
  end
end
